<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VendorConnect - Empowering Street Vendors</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --coral: #FF6B6B;
            --yellow: #FFD93D;
            --mint: #6BCB77;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            padding: 30px;
            margin: 20px 0;
        }

        .hidden {
            display: none !important;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .lang-selector {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            padding: 8px 15px;
            color: white;
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .lang-selector option {
            background: #2c3e50;
            color: white;
            padding: 5px;
        }

        .lang-selector:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Buttons */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--coral), var(--yellow));
            color: white;
            margin: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, var(--mint), #4ecdc4);
            color: white;
            margin: 10px;
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(107, 203, 119, 0.4);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid transparent;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--coral);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.2);
        }

        /* Landing Page */
        .hero {
            text-align: center;
            color: white;
            padding: 50px 0;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: fadeInUp 1s ease;
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
            animation: fadeInUp 1s ease 0.2s both;
        }

        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }

        /* Chatbot */
        .chatbot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, var(--coral), var(--yellow));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .chatbot:hover {
            transform: scale(1.1);
        }

        .chatbot-window {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 300px;
            height: 400px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            z-index: 1001;
            display: flex;
            flex-direction: column;
        }

        .chatbot-header {
            padding: 15px;
            border-bottom: 1px solid var(--glass-border);
            color: white;
            font-weight: bold;
        }

        .chatbot-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            color: white;
        }

        .chatbot-input {
            padding: 15px;
            border-top: 1px solid var(--glass-border);
        }

        .chatbot-input input {
            width: 100%;
            padding: 8px 12px;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .chatbot-input input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 10px;
            }
            
            .glass {
                padding: 20px;
            }
            
            .chatbot-window {
                width: calc(100vw - 40px);
                right: 20px;
            }
        }

        /* Invoice Styles */
        .invoice {
            background: white;
            color: var(--text-primary);
            max-width: 800px;
            margin: 0 auto;
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--coral);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .invoice-table th,
        .invoice-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .invoice-table th {
            background: var(--coral);
            color: white;
        }

        /* Toggle Switch */
        .toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--mint);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }


    </style>
</head>
<body>


    <!-- Header -->
    <div class="container">
        <div class="header">
            <div class="logo">VendorConnect</div>
            <div style="display: flex; align-items: center; gap: 20px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <label class="toggle">
                        <input type="checkbox" id="adminToggle">
                        <span class="slider"></span>
                    </label>
                    <span style="color: white;">Admin</span>
                </div>
                <select class="lang-selector" id="languageSelect">
                    <option value="en">English</option>
                    <option value="hi">हिंदी</option>
                    <option value="ta">தமிழ்</option>
                </select>
            </div>
        </div>

        <!-- Landing Page -->
        <div id="landingPage" class="page">
            <div class="hero">
                <h1 id="heroTitle">Empowering Street Vendors Through Bulk Buying</h1>
                <p id="heroDesc">Join forces with fellow vendors to unlock better prices, reduce costs, and grow your business together. Connect with trusted suppliers and streamline your procurement process.</p>
                <div>
                    <button class="btn btn-primary" onclick="showPage('vendorRegistration')" id="joinGroupBtn">Join a Vendor Group</button>
                    <button class="btn btn-secondary" onclick="showPage('supplierRegistration')" id="becomeSupplierBtn">Become a Supplier</button>
                </div>
            </div>
        </div>

        <!-- Vendor Registration -->
        <div id="vendorRegistration" class="page hidden">
            <div class="glass">
                <h2 id="vendorRegTitle">Vendor Registration</h2>
                <form id="vendorForm">
                    <div class="form-group">
                        <label id="nameLabel">Name</label>
                        <input type="text" id="vendorName" required>
                    </div>
                    <div class="form-group">
                        <label id="phoneLabel">Phone Number</label>
                        <input type="tel" id="vendorPhone" required>
                    </div>
                    <div class="form-group">
                        <label id="areaLabel">Area</label>
                        <input type="text" id="vendorArea" required>
                    </div>
                    <div class="form-group">
                        <label id="whatsappLabel">WhatsApp Number</label>
                        <input type="tel" id="vendorWhatsapp" required>
                    </div>
                    <div class="form-group">
                        <label id="emailLabel">Email ID</label>
                        <input type="email" id="vendorEmail" required>
                    </div>
                    <div class="form-group">
                        <label id="productLabel">Search Product</label>
                        <input type="text" id="vendorProduct" placeholder="e.g., Rice, Oil, Vegetables">
                    </div>
                    <div class="form-group">
                        <label id="timeSlotLabel">Preferred Time Slot</label>
                        <select id="vendorTimeSlot">
                            <option value="morning">Morning (6AM - 12PM)</option>
                            <option value="afternoon">Afternoon (12PM - 6PM)</option>
                            <option value="evening">Evening (6PM - 10PM)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label id="licenseLabel">Upload License</label>
                        <input type="file" id="vendorLicense" accept=".pdf,.jpg,.png">
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <button type="button" class="btn btn-primary" onclick="createGroup()" id="createGroupBtn" style="display: none;">Create Group</button>
                        <button type="button" class="btn btn-secondary" onclick="showJoinGroup()" id="joinGroupBtn2" style="display: none;">Join Group with Code</button>
                    </div>
                    
                    <div id="joinGroupSection" class="hidden">
                        <div class="form-group">
                            <label id="groupCodeLabel">Group Code</label>
                            <input type="text" id="groupCode" placeholder="Enter group code">
                        </div>
                        <button type="button" class="btn btn-primary" onclick="joinGroup()" id="joinGroupSubmitBtn">Join Group</button>
                    </div>
                    
                    <div id="otpSection" class="hidden">
                        <div class="form-group">
                            <label id="otpVerifyLabel">Enter OTP</label>
                            <input type="text" id="vendorOtp" placeholder="Enter OTP sent to your email">
                            <p style="color: var(--mint); margin-top: 5px; font-size: 0.9rem;">Demo OTP: 123456</p>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="verifyVendorOtp()" id="verifyOtpBtn">Verify OTP</button>
                    </div>
                    
                    <button type="button" class="btn btn-primary" onclick="registerVendor()" id="registerVendorBtn">Register</button>
                </form>
            </div>
        </div>

        <!-- Supplier Registration -->
        <div id="supplierRegistration" class="page hidden">
            <div class="glass">
                <h2 id="supplierRegTitle">Supplier Registration</h2>
                <form id="supplierForm">
                    <div class="form-group">
                        <label id="supplierNameLabel">Name</label>
                        <input type="text" id="supplierName" required>
                    </div>
                    <div class="form-group">
                        <label id="productTypeLabel">Type of Products</label>
                        <input type="text" id="supplierProducts" placeholder="e.g., Grains, Vegetables, Dairy">
                    </div>
                    <div class="form-group">
                        <label id="areasServedLabel">Areas Served</label>
                        <input type="text" id="supplierAreas" placeholder="e.g., Downtown, Market Street">
                    </div>
                    <div class="form-group">
                        <label id="contactLabel">Contact Number</label>
                        <input type="tel" id="supplierContact" required>
                    </div>
                    <div class="form-group">
                        <label id="minOrderLabel">Minimum Order Quantity</label>
                        <input type="text" id="supplierMinOrder" placeholder="e.g., 50kg, 100 liters">
                    </div>
                    <div class="form-group">
                        <label id="supplierEmailLabel">Email ID</label>
                        <input type="email" id="supplierEmail" required>
                    </div>
                    <div class="form-group">
                        <label id="fssaiLabel">FSSAI License</label>
                        <input type="file" id="fssaiLicense" accept=".pdf,.jpg,.png">
                        <button type="button" class="btn btn-small btn-secondary" onclick="verifyFSSAI()" id="verifyFSSAIBtn">Verify FSSAI</button>
                    </div>
                    <div class="form-group">
                        <label id="tradingLabel">Trading License</label>
                        <input type="file" id="tradingLicense" accept=".pdf,.jpg,.png">
                        <button type="button" class="btn btn-small btn-secondary" onclick="verifyTrading()" id="verifyTradingBtn">Verify Trading</button>
                    </div>
                    
                    <div id="supplierOtpSection" class="hidden">
                        <div class="form-group">
                            <label id="supplierOtpLabel">Enter OTP</label>
                            <input type="text" id="supplierOtp" placeholder="Enter OTP sent to your email">
                            <p style="color: var(--mint); margin-top: 5px; font-size: 0.9rem;">Demo OTP: 123456</p>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="verifySupplierOtp()" id="verifySupplierOtpBtn">Verify OTP</button>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" id="registerSupplierBtn">Register</button>
                </form>
            </div>
        </div>

        <!-- Group Dashboard -->
        <div id="groupDashboard" class="page hidden">
            <div class="glass">
                <h2 id="dashboardTitle">Group Dashboard</h2>
                <div id="groupInfo"></div>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3 id="vendorsTitle">Group Members</h3>
                        <div id="vendorsList"></div>
                    </div>
                    
                    <div class="card">
                        <h3 id="productCatalogTitle">Available Products</h3>
                        <div id="productCatalog"></div>
                        
                        <h3 id="cartTitle" style="margin-top: 30px;">Shopping Cart</h3>
                        <div id="cartItems"></div>
                        <div id="cartTotal"></div>
                        
                        <div style="margin-top: 20px;">
                            <button type="button" class="btn btn-primary" onclick="checkout()" id="checkoutBtn">Checkout</button>
                            <button type="button" class="btn btn-secondary" onclick="clearCart()" id="clearCartBtn">Clear Cart</button>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <label class="toggle">
                                <input type="checkbox" id="paidToggle" onchange="markAsPaid()">
                                <span class="slider"></span>
                            </label>
                            <span id="paidLabel">Mark as Paid</span>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3 id="historyTitle">Payment History</h3>
                    <div id="paymentHistory"></div>
                </div>
                
                <div style="margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="showPage('supplierView')" id="viewSuppliersBtn">View Suppliers</button>
                    <button class="btn btn-primary" onclick="showCartView()" id="viewCartBtn">View Cart Details</button>
                    <button class="btn btn-secondary" onclick="generateInvoice()" id="generateInvoiceFromDashBtn">Generate Invoice</button>
                </div>
            </div>
        </div>

        <!-- Supplier View -->
        <div id="supplierView" class="page hidden">
            <div class="glass">
                <h2 id="supplierViewTitle">Supplier Dashboard</h2>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3 id="incomingOrdersTitle">Incoming Orders</h3>
                        <div id="incomingOrders"></div>
                    </div>
                    
                    <div class="card">
                        <h3 id="deliveryPrefTitle">Delivery Preferences</h3>
                        <div class="form-group">
                            <label id="deliveryTimeLabel">Preferred Delivery Time</label>
                            <select id="deliveryTime">
                                <option value="morning">Morning (8AM - 12PM)</option>
                                <option value="afternoon">Afternoon (1PM - 5PM)</option>
                                <option value="evening">Evening (6PM - 9PM)</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="confirmDelivery()" id="confirmDeliveryBtn">Confirm Delivery</button>
                    </div>
                    
                    <div class="card">
                        <h3 id="paymentSimTitle">Payment Simulation</h3>
                        <div id="paymentDetails"></div>
                        <div class="form-group">
                            <label id="upiLabel">UPI ID</label>
                            <input type="text" id="upiId" placeholder="Enter your UPI ID (e.g., vendor@paytm)">
                        </div>
                        <button class="btn btn-primary" onclick="processPayment()" id="processPaymentBtn">Process Payment</button>
                    </div>
                </div>
                
                <button class="btn btn-secondary" onclick="generateInvoice()" id="generateInvoiceBtn">Generate Invoice</button>
            </div>
        </div>

        <!-- Cart View Page -->
        <div id="cartViewPage" class="page hidden">
            <div class="glass">
                <h2 id="cartViewTitle">Cart Details</h2>
                <div id="cartViewContent"></div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="showPage('groupDashboard')" id="backToDashboardBtn">Back to Dashboard</button>
                    <button class="btn btn-primary" onclick="checkout()" id="checkoutFromCartBtn">Checkout</button>
                </div>
            </div>
        </div>

        <!-- Invoice Page -->
        <div id="invoicePage" class="page hidden">
            <div class="glass invoice">
                <div class="invoice-header">
                    <div>
                        <h2>INVOICE</h2>
                        <p id="invoiceId">Invoice #: INV-001</p>
                        <p id="invoiceDate">Date: </p>
                    </div>
                    <div class="logo">VendorConnect</div>
                </div>
                
                <div id="invoiceContent">
                    <table class="invoice-table">
                        <thead>
                            <tr>
                                <th id="itemHeader">Item</th>
                                <th id="qtyHeader">Quantity</th>
                                <th id="priceHeader">Price</th>
                                <th id="totalHeader">Total</th>
                            </tr>
                        </thead>
                        <tbody id="invoiceItems">
                        </tbody>
                    </table>
                    
                    <div style="text-align: right; margin-top: 20px;">
                        <h3 id="grandTotal">Grand Total: ₹0</h3>
                    </div>
                </div>
                
                <div style="margin-top: 30px; text-align: center;">
                    <button class="btn btn-primary" onclick="downloadInvoice()" id="downloadBtn">Download PDF</button>
                    <button class="btn btn-secondary" onclick="printInvoice()" id="printBtn">Print Invoice</button>
                </div>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="page hidden">
            <div class="glass">
                <h2 id="adminTitle">Admin Panel</h2>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3 id="vendorListTitle">Vendor List</h3>
                        <div id="adminVendorList"></div>
                    </div>
                    
                    <div class="card">
                        <h3 id="supplierListTitle">Supplier List</h3>
                        <div id="adminSupplierList"></div>
                    </div>
                    
                    <div class="card">
                        <h3 id="groupListTitle">Group List</h3>
                        <div id="adminGroupList"></div>
                        <button class="btn btn-primary" onclick="deleteGroup()" id="deleteGroupBtn">Delete Selected Group</button>
                    </div>
                    
                    <div class="card">
                        <h3 id="orderSummaryTitle">Order Summary</h3>
                        <div id="adminOrderSummary"></div>
                        <button class="btn btn-secondary" onclick="resetSimulation()" id="resetBtn">Reset Simulation</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div id="loginModal" class="page hidden">
            <div class="glass" style="max-width: 400px; margin: 50px auto;">
                <h2 id="loginTitle">Login</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label id="loginEmailLabel">Email</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label id="otpLabel">OTP</label>
                        <input type="text" id="loginOtp" placeholder="Enter OTP">
                        <button type="button" class="btn btn-small btn-secondary" onclick="sendOtp()" id="sendOtpBtn">Send OTP</button>
                    </div>
                    <button type="submit" class="btn btn-primary" id="loginSubmitBtn">Login</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Chatbot -->
    <div class="chatbot" onclick="toggleChatbot()">
        💬
    </div>
    
    <div id="chatbotWindow" class="chatbot-window hidden">
        <div class="chatbot-header">
            <span id="chatbotTitle">VendorConnect Assistant</span>
            <span style="float: right; cursor: pointer;" onclick="toggleChatbot()">×</span>
        </div>
        <div class="chatbot-messages" id="chatbotMessages">
            <div id="welcomeMsg">Hello! How can I help you today?</div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatInput" placeholder="Type your message..." onkeypress="handleChatInput(event)">
        </div>
    </div>

    <script>
        // Global variables
        let currentLanguage = 'en';
        let currentUser = null;
        let currentGroup = null;
        let vendors = JSON.parse(localStorage.getItem('vendors') || '[]');
        let suppliers = JSON.parse(localStorage.getItem('suppliers') || '[]');
        let groups = JSON.parse(localStorage.getItem('groups') || '[]');
        let orders = JSON.parse(localStorage.getItem('orders') || '[]');
        let paymentHistory = JSON.parse(localStorage.getItem('paymentHistory') || '[]');
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');

        // Product catalog with comprehensive fruits, vegetables, spices, and groceries
        const productCatalog = [
            // Grains & Staples
            { id: 1, name: 'Basmati Rice', price: 80, unit: 'kg', category: 'Grains', image: '🍚' },
            { id: 2, name: 'Regular Rice', price: 60, unit: 'kg', category: 'Grains', image: '🍚' },
            { id: 3, name: 'Brown Rice', price: 90, unit: 'kg', category: 'Grains', image: '🍚' },
            { id: 4, name: 'Wheat Flour', price: 45, unit: 'kg', category: 'Flour', image: '🌾' },
            { id: 5, name: 'All Purpose Flour (Maida)', price: 40, unit: 'kg', category: 'Flour', image: '🌾' },
            { id: 6, name: 'Rice Flour', price: 50, unit: 'kg', category: 'Flour', image: '🌾' },
            { id: 7, name: 'Gram Flour (Besan)', price: 70, unit: 'kg', category: 'Flour', image: '🌾' },
            { id: 8, name: 'Corn Flour', price: 60, unit: 'kg', category: 'Flour', image: '🌾' },
            { id: 9, name: 'Semolina (Suji)', price: 55, unit: 'kg', category: 'Flour', image: '🌾' },
            { id: 10, name: 'Oats Flour', price: 120, unit: 'kg', category: 'Flour', image: '🌾' },
            { id: 11, name: 'Sugar', price: 42, unit: 'kg', category: 'Sweeteners', image: '🍯' },
            { id: 12, name: 'Salt', price: 20, unit: 'kg', category: 'Spices', image: '🧂' },
            { id: 13, name: 'Cooking Oil', price: 120, unit: 'liter', category: 'Oil', image: '🛢️' },
            { id: 14, name: 'Mustard Oil', price: 140, unit: 'liter', category: 'Oil', image: '🛢️' },
            { id: 15, name: 'Coconut Oil', price: 180, unit: 'liter', category: 'Oil', image: '🛢️' },
            { id: 16, name: 'Sesame Oil', price: 200, unit: 'liter', category: 'Oil', image: '🛢️' },
            
            // Spices & Seasonings
            { id: 17, name: 'Turmeric Powder', price: 150, unit: 'kg', category: 'Spices', image: '🟡' },
            { id: 18, name: 'Red Chili Powder', price: 200, unit: 'kg', category: 'Spices', image: '🌶️' },
            { id: 19, name: 'Coriander Powder', price: 180, unit: 'kg', category: 'Spices', image: '🌿' },
            { id: 20, name: 'Cumin Powder', price: 300, unit: 'kg', category: 'Spices', image: '🟤' },
            { id: 21, name: 'Garam Masala', price: 400, unit: 'kg', category: 'Spices', image: '🌶️' },
            { id: 22, name: 'Black Pepper', price: 800, unit: 'kg', category: 'Spices', image: '⚫' },
            { id: 23, name: 'Cardamom', price: 2000, unit: 'kg', category: 'Spices', image: '🟢' },
            { id: 24, name: 'Cinnamon', price: 600, unit: 'kg', category: 'Spices', image: '🟤' },
            { id: 25, name: 'Cloves', price: 1200, unit: 'kg', category: 'Spices', image: '🟤' },
            { id: 26, name: 'Bay Leaves', price: 400, unit: 'kg', category: 'Spices', image: '🍃' },
            { id: 27, name: 'Mustard Seeds', price: 120, unit: 'kg', category: 'Spices', image: '🟡' },
            { id: 28, name: 'Cumin Seeds', price: 250, unit: 'kg', category: 'Spices', image: '🟤' },
            { id: 29, name: 'Coriander Seeds', price: 100, unit: 'kg', category: 'Spices', image: '🟤' },
            { id: 30, name: 'Fenugreek Seeds', price: 80, unit: 'kg', category: 'Spices', image: '🟤' },
            { id: 31, name: 'Fennel Seeds', price: 200, unit: 'kg', category: 'Spices', image: '🟢' },
            { id: 32, name: 'Asafoetida (Hing)', price: 3000, unit: 'kg', category: 'Spices', image: '🟡' },
            { id: 33, name: 'Star Anise', price: 800, unit: 'kg', category: 'Spices', image: '⭐' },
            { id: 34, name: 'Nutmeg', price: 1500, unit: 'kg', category: 'Spices', image: '🟤' },
            { id: 35, name: 'Mace', price: 2000, unit: 'kg', category: 'Spices', image: '🟠' },
            { id: 36, name: 'Carom Seeds (Ajwain)', price: 300, unit: 'kg', category: 'Spices', image: '🟤' },
            { id: 37, name: 'Nigella Seeds (Kalonji)', price: 400, unit: 'kg', category: 'Spices', image: '⚫' },
            { id: 38, name: 'Poppy Seeds', price: 600, unit: 'kg', category: 'Spices', image: '⚪' },
            { id: 39, name: 'Sesame Seeds', price: 150, unit: 'kg', category: 'Spices', image: '⚪' },
            { id: 40, name: 'Dry Red Chilies', price: 300, unit: 'kg', category: 'Spices', image: '🌶️' },
            
            // Pulses & Lentils
            { id: 41, name: 'Toor Dal', price: 120, unit: 'kg', category: 'Pulses', image: '🟡' },
            { id: 42, name: 'Moong Dal', price: 140, unit: 'kg', category: 'Pulses', image: '🟢' },
            { id: 43, name: 'Chana Dal', price: 100, unit: 'kg', category: 'Pulses', image: '🟡' },
            { id: 44, name: 'Urad Dal', price: 160, unit: 'kg', category: 'Pulses', image: '⚫' },
            { id: 45, name: 'Masoor Dal', price: 110, unit: 'kg', category: 'Pulses', image: '🔴' },
            { id: 46, name: 'Rajma (Kidney Beans)', price: 180, unit: 'kg', category: 'Pulses', image: '🔴' },
            { id: 47, name: 'Chickpeas (Kabuli Chana)', price: 120, unit: 'kg', category: 'Pulses', image: '⚪' },
            { id: 48, name: 'Black Gram (Kala Chana)', price: 100, unit: 'kg', category: 'Pulses', image: '⚫' },
            { id: 49, name: 'Green Peas (Dried)', price: 80, unit: 'kg', category: 'Pulses', image: '🟢' },
            { id: 50, name: 'Black Eyed Peas', price: 90, unit: 'kg', category: 'Pulses', image: '⚪' },
            
            // Groceries & Packaged Items
            { id: 51, name: 'Tea Leaves', price: 200, unit: 'kg', category: 'Beverages', image: '🍃' },
            { id: 52, name: 'Coffee Beans', price: 400, unit: 'kg', category: 'Beverages', image: '☕' },
            { id: 53, name: 'Milk Powder', price: 350, unit: 'kg', category: 'Dairy', image: '🥛' },
            { id: 54, name: 'Ghee', price: 500, unit: 'kg', category: 'Dairy', image: '🧈' },
            { id: 55, name: 'Paneer', price: 300, unit: 'kg', category: 'Dairy', image: '🧀' },
            { id: 56, name: 'Yogurt', price: 60, unit: 'kg', category: 'Dairy', image: '🥛' },
            { id: 101, name: 'Fresh Milk', price: 50, unit: 'liter', category: 'Dairy', image: '🥛' },
            { id: 102, name: 'Butter', price: 400, unit: 'kg', category: 'Dairy', image: '🧈' },
            { id: 103, name: 'Cheese', price: 450, unit: 'kg', category: 'Dairy', image: '🧀' },
            { id: 104, name: 'Cream', price: 200, unit: 'liter', category: 'Dairy', image: '🥛' },
            { id: 105, name: 'Buttermilk', price: 40, unit: 'liter', category: 'Dairy', image: '🥛' },
            { id: 106, name: 'Cottage Cheese', price: 280, unit: 'kg', category: 'Dairy', image: '🧀' },
            { id: 107, name: 'Mozzarella Cheese', price: 500, unit: 'kg', category: 'Dairy', image: '🧀' },
            { id: 108, name: 'Cheddar Cheese', price: 550, unit: 'kg', category: 'Dairy', image: '🧀' },
            { id: 109, name: 'Greek Yogurt', price: 120, unit: 'kg', category: 'Dairy', image: '🥛' },
            { id: 110, name: 'Sour Cream', price: 180, unit: 'kg', category: 'Dairy', image: '🥛' },
            { id: 57, name: 'Honey', price: 300, unit: 'kg', category: 'Sweeteners', image: '🍯' },
            { id: 58, name: 'Jaggery', price: 80, unit: 'kg', category: 'Sweeteners', image: '🟤' },
            { id: 59, name: 'Rock Salt', price: 25, unit: 'kg', category: 'Spices', image: '🧂' },
            { id: 60, name: 'Black Salt', price: 40, unit: 'kg', category: 'Spices', image: '⚫' },
            
            // Fruits
            { id: 61, name: 'Apples', price: 150, unit: 'kg', category: 'Fruits', image: '🍎' },
            { id: 62, name: 'Bananas', price: 60, unit: 'kg', category: 'Fruits', image: '🍌' },
            { id: 63, name: 'Oranges', price: 80, unit: 'kg', category: 'Fruits', image: '🍊' },
            { id: 64, name: 'Mangoes', price: 120, unit: 'kg', category: 'Fruits', image: '🥭' },
            { id: 65, name: 'Grapes', price: 100, unit: 'kg', category: 'Fruits', image: '🍇' },
            { id: 66, name: 'Strawberries', price: 200, unit: 'kg', category: 'Fruits', image: '🍓' },
            { id: 67, name: 'Pineapple', price: 50, unit: 'piece', category: 'Fruits', image: '🍍' },
            { id: 68, name: 'Watermelon', price: 25, unit: 'kg', category: 'Fruits', image: '🍉' },
            { id: 69, name: 'Lemon', price: 80, unit: 'kg', category: 'Fruits', image: '🍋' },
            { id: 70, name: 'Coconut', price: 40, unit: 'piece', category: 'Fruits', image: '🥥' },
            
            // Vegetables
            { id: 71, name: 'Onions', price: 30, unit: 'kg', category: 'Vegetables', image: '🧅' },
            { id: 72, name: 'Potatoes', price: 25, unit: 'kg', category: 'Vegetables', image: '🥔' },
            { id: 73, name: 'Tomatoes', price: 40, unit: 'kg', category: 'Vegetables', image: '🍅' },
            { id: 74, name: 'Carrots', price: 50, unit: 'kg', category: 'Vegetables', image: '🥕' },
            { id: 75, name: 'Cabbage', price: 20, unit: 'kg', category: 'Vegetables', image: '🥬' },
            { id: 76, name: 'Cauliflower', price: 35, unit: 'kg', category: 'Vegetables', image: '🥦' },
            { id: 77, name: 'Broccoli', price: 80, unit: 'kg', category: 'Vegetables', image: '🥦' },
            { id: 78, name: 'Spinach', price: 40, unit: 'kg', category: 'Vegetables', image: '🥬' },
            { id: 79, name: 'Cucumber', price: 30, unit: 'kg', category: 'Vegetables', image: '🥒' },
            { id: 80, name: 'Bell Peppers', price: 80, unit: 'kg', category: 'Vegetables', image: '🫑' },
            { id: 81, name: 'Green Chili', price: 60, unit: 'kg', category: 'Vegetables', image: '🌶️' },
            { id: 82, name: 'Eggplant', price: 45, unit: 'kg', category: 'Vegetables', image: '🍆' },
            { id: 83, name: 'Okra', price: 50, unit: 'kg', category: 'Vegetables', image: '🟢' },
            { id: 84, name: 'Green Beans', price: 70, unit: 'kg', category: 'Vegetables', image: '🫘' },
            { id: 85, name: 'Corn', price: 40, unit: 'kg', category: 'Vegetables', image: '🌽' },
            { id: 86, name: 'Sweet Potato', price: 35, unit: 'kg', category: 'Vegetables', image: '🍠' },
            { id: 87, name: 'Beetroot', price: 45, unit: 'kg', category: 'Vegetables', image: '🟣' },
            { id: 88, name: 'Radish', price: 25, unit: 'kg', category: 'Vegetables', image: '⚪' },
            { id: 89, name: 'Ginger', price: 120, unit: 'kg', category: 'Vegetables', image: '🫚' },
            { id: 90, name: 'Garlic', price: 200, unit: 'kg', category: 'Vegetables', image: '🧄' },
            { id: 91, name: 'Mushrooms', price: 150, unit: 'kg', category: 'Vegetables', image: '🍄' },
            { id: 92, name: 'Pumpkin', price: 20, unit: 'kg', category: 'Vegetables', image: '🎃' },
            { id: 93, name: 'Bottle Gourd', price: 25, unit: 'kg', category: 'Vegetables', image: '🟢' },
            { id: 94, name: 'Bitter Gourd', price: 50, unit: 'kg', category: 'Vegetables', image: '🟢' },
            { id: 95, name: 'Drumstick', price: 80, unit: 'kg', category: 'Vegetables', image: '🟤' },
            
            // Leafy Greens
            { id: 96, name: 'Mint Leaves', price: 100, unit: 'kg', category: 'Leafy Greens', image: '🌿' },
            { id: 97, name: 'Coriander Leaves', price: 120, unit: 'kg', category: 'Leafy Greens', image: '🌿' },
            { id: 98, name: 'Curry Leaves', price: 200, unit: 'kg', category: 'Leafy Greens', image: '🍃' },
            { id: 99, name: 'Fenugreek Leaves', price: 80, unit: 'kg', category: 'Leafy Greens', image: '🌿' },
            { id: 100, name: 'Dill Leaves', price: 100, unit: 'kg', category: 'Leafy Greens', image: '🌿' }
        ];

        // Translations
        const translations = {
            en: {
                heroTitle: "Empowering Street Vendors Through Bulk Buying",
                heroDesc: "Join forces with fellow vendors to unlock better prices, reduce costs, and grow your business together.",
                joinGroupBtn: "Join a Vendor Group",
                becomeSupplierBtn: "Become a Supplier",
                vendorRegTitle: "Vendor Registration",
                nameLabel: "Name",
                phoneLabel: "Phone Number",
                areaLabel: "Area",
                whatsappLabel: "WhatsApp Number",
                emailLabel: "Email ID",
                productLabel: "Search Product",
                timeSlotLabel: "Preferred Time Slot",
                licenseLabel: "Upload License",
                createGroupBtn: "Create Group",
                joinGroupBtn2: "Join Group with Code",
                groupCodeLabel: "Group Code",
                registerVendorBtn: "Register",
                chatbotTitle: "VendorConnect Assistant",
                welcomeMsg: "Hello! How can I help you today?"
            },
            hi: {
                heroTitle: "थोक खरीदारी के माध्यम से स्ट्रीट वेंडर्स को सशक्त बनाना",
                heroDesc: "बेहतर कीमतों को अनलॉक करने, लागत कम करने और अपने व्यवसाय को एक साथ बढ़ाने के लिए साथी विक्रेताओं के साथ मिलें।",
                joinGroupBtn: "वेंडर ग्रुप में शामिल हों",
                becomeSupplierBtn: "आपूर्तिकर्ता बनें",
                vendorRegTitle: "विक्रेता पंजीकरण",
                nameLabel: "नाम",
                phoneLabel: "फोन नंबर",
                areaLabel: "क्षेत्र",
                whatsappLabel: "व्हाट्सएप नंबर",
                emailLabel: "ईमेल आईडी",
                productLabel: "उत्पाद खोजें",
                timeSlotLabel: "पसंदीदा समय स्लॉट",
                licenseLabel: "लाइसेंस अपलोड करें",
                createGroupBtn: "ग्रुप बनाएं",
                joinGroupBtn2: "कोड के साथ ग्रुप में शामिल हों",
                groupCodeLabel: "ग्रुप कोड",
                registerVendorBtn: "पंजीकरण करें",
                chatbotTitle: "वेंडरकनेक्ट सहायक",
                welcomeMsg: "नमस्ते! आज मैं आपकी कैसे मदद कर सकता हूं?"
            },
            ta: {
                heroTitle: "மொத்த வாங்குதல் மூலம் தெரு விற்பனையாளர்களை வலுப்படுத்துதல்",
                heroDesc: "சிறந்த விலைகளைப் பெற, செலவுகளைக் குறைக்க மற்றும் உங்கள் வணிகத்தை ஒன்றாக வளர்க்க சக விற்பனையாளர்களுடன் சேரவும்.",
                joinGroupBtn: "விற்பனையாளர் குழுவில் சேரவும்",
                becomeSupplierBtn: "சப்ளையர் ஆகவும்",
                vendorRegTitle: "விற்பனையாளர் பதிவு",
                nameLabel: "பெயர்",
                phoneLabel: "தொலைபேசி எண்",
                areaLabel: "பகுதி",
                whatsappLabel: "வாட்ஸ்அப் எண்",
                emailLabel: "மின்னஞ்சல் ஐடி",
                productLabel: "தயாரிப்பு தேடவும்",
                timeSlotLabel: "விருப்பமான நேர இடைவெளி",
                licenseLabel: "உரிமம் பதிவேற்றவும்",
                createGroupBtn: "குழு உருவாக்கவும்",
                joinGroupBtn2: "குறியீட்டுடன் குழுவில் சேரவும்",
                groupCodeLabel: "குழு குறியீடு",
                registerVendorBtn: "பதிவு செய்யவும்",
                chatbotTitle: "வெண்டர்கனெக்ட் உதவியாளர்",
                welcomeMsg: "வணக்கம்! இன்று நான் உங்களுக்கு எப்படி உதவ முடியும்?"
            }
        };



        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadUserSession();
            updateLanguage();
            loadAdminData();
        });

        // Language functions
        function changeLanguage() {
            currentLanguage = document.getElementById('languageSelect').value;
            updateLanguage();
        }

        function updateLanguage() {
            const lang = translations[currentLanguage];
            if (!lang) return;

            Object.keys(lang).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    if (element.tagName === 'INPUT' && element.type !== 'submit') {
                        element.placeholder = lang[key];
                    } else {
                        element.textContent = lang[key];
                    }
                }
            });
        }

        // Page navigation
        window.showPage = function(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });
            document.getElementById(pageId).classList.remove('hidden');
        }

        // Authentication
        window.sendOtp = function() {
            const email = document.getElementById('loginEmail').value;
            if (!email) {
                alert('Please enter email address');
                return;
            }
            
            const otp = Math.floor(100000 + Math.random() * 900000);
            localStorage.setItem('currentOtp', otp);
            alert(`Demo OTP sent to ${email}: ${otp}`);
            console.log(`OTP for ${email}: ${otp}`);
        }

        window.login = function(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const otp = document.getElementById('loginOtp').value;
            const storedOtp = localStorage.getItem('currentOtp');
            
            if (otp === storedOtp) {
                currentUser = { email: email };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                alert('Login successful!');
                showPage('landingPage');
            } else {
                alert('Invalid OTP');
            }
        }

        function loadUserSession() {
            const user = localStorage.getItem('currentUser');
            if (user) {
                currentUser = JSON.parse(user);
            }
        }

        // Vendor functions
        window.registerVendor = function() {
            const vendorData = getVendorFormData();
            if (!vendorData) return;
            
            // Show OTP section and hide register button
            document.getElementById('otpSection').classList.remove('hidden');
            document.getElementById('registerVendorBtn').classList.add('hidden');
            
            alert(`OTP sent to ${vendorData.email}!\nDemo OTP: 123456`);
            console.log('OTP sent for vendor registration');
        }
        
        window.verifyVendorOtp = function() {
            const enteredOtp = document.getElementById('vendorOtp').value;
            const correctOtp = '123456';
            
            if (enteredOtp === correctOtp) {
                const vendorData = getVendorFormData();
                if (!vendorData) return;
                
                vendors.push(vendorData);
                localStorage.setItem('vendors', JSON.stringify(vendors));
                
                alert('OTP verified successfully! Vendor registered. You can now create or join a group.');
                console.log('Vendor registered:', vendorData);
                
                // Show create/join group buttons
                document.getElementById('createGroupBtn').style.display = 'inline-block';
                document.getElementById('joinGroupBtn2').style.display = 'inline-block';
            } else {
                alert('Invalid OTP! Please enter 123456');
            }
        }
        
        window.createGroup = function() {
            
            const groupCode = 'GRP' + Math.random().toString(36).substr(2, 6).toUpperCase();
            const vendorData = getVendorFormData();
            
            if (!vendorData) return;
            
            const newGroup = {
                id: groupCode,
                code: groupCode,
                leader: vendorData,
                members: [vendorData],
                orders: [],
                createdAt: new Date().toISOString()
            };
            
            groups.push(newGroup);
            
            // Only add vendor if not already in vendors array
            const existingVendor = vendors.find(v => v.email === vendorData.email);
            if (!existingVendor) {
                vendors.push(vendorData);
            }
            
            localStorage.setItem('groups', JSON.stringify(groups));
            localStorage.setItem('vendors', JSON.stringify(vendors));
            
            currentGroup = newGroup;
            
            alert(`Group created successfully! Your group code is: ${groupCode}`);
            console.log('Group created:', newGroup);
            
            showPage('groupDashboard');
            loadGroupDashboard();
        }

        window.showJoinGroup = function() {
            document.getElementById('joinGroupSection').classList.remove('hidden');
        }

        window.joinGroup = function() {
            const groupCode = document.getElementById('groupCode').value.trim();
            
            if (!groupCode) {
                alert('Please enter group code');
                return;
            }
            
            // Check if OTP is verified first
            const otpSection = document.getElementById('otpSection');
            const otpInput = document.getElementById('vendorOtp');
            
            if (!otpSection.classList.contains('hidden') && (!otpInput.value || otpInput.value !== '123456')) {
                alert('Please verify OTP first before joining a group. Enter 123456 in the OTP field and click Verify OTP.');
                return;
            }
            
            const vendorData = getVendorFormData();
            if (!vendorData) {
                alert('Please fill all required fields');
                return;
            }
            
            const group = groups.find(g => g.code === groupCode);
            if (!group) {
                alert('Invalid group code. Please check and try again.');
                return;
            }
            
            // Check if vendor already in group
            const alreadyMember = group.members.find(m => m.email === vendorData.email);
            if (alreadyMember) {
                alert('You are already a member of this group!');
                currentGroup = group;
                showPage('groupDashboard');
                loadGroupDashboard();
                return;
            }
            
            group.members.push(vendorData);
            
            // Only add vendor if not already in vendors array
            const existingVendor = vendors.find(v => v.email === vendorData.email);
            if (!existingVendor) {
                vendors.push(vendorData);
            }
            
            localStorage.setItem('groups', JSON.stringify(groups));
            localStorage.setItem('vendors', JSON.stringify(vendors));
            
            currentGroup = group;
            
            // Show success animation
            showJoinGroupSuccess(groupCode, group.members.length);
        }
        
        function showJoinGroupSuccess(groupCode, memberCount) {
            // Create success overlay
            const successOverlay = document.createElement('div');
            successOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(107, 203, 119, 0.95);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                animation: fadeIn 0.5s ease;
            `;
            
            const successContent = document.createElement('div');
            successContent.style.cssText = `
                background: white;
                padding: 40px;
                border-radius: 20px;
                text-align: center;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                max-width: 500px;
                animation: slideUp 0.6s ease;
            `;
            
            successContent.innerHTML = `
                <div style="font-size: 4rem; color: #6BCB77; margin-bottom: 20px;">🎉</div>
                <h2 style="color: #2c3e50; margin-bottom: 15px;">Successfully Joined Group!</h2>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <p style="margin: 8px 0; color: #495057;"><strong>Group Code:</strong> ${groupCode}</p>
                    <p style="margin: 8px 0; color: #495057;"><strong>Total Members:</strong> ${memberCount}</p>
                    <p style="margin: 8px 0; color: #495057;"><strong>Status:</strong> Active Member</p>
                </div>
                <p style="color: #6c757d; margin: 15px 0;">You can now start bulk shopping with your group members and enjoy better prices!</p>
                <button onclick="closeJoinSuccess()" style="
                    background: linear-gradient(45deg, #6BCB77, #4ecdc4);
                    color: white;
                    border: none;
                    padding: 12px 30px;
                    border-radius: 25px;
                    font-size: 1rem;
                    cursor: pointer;
                    margin-top: 20px;
                    box-shadow: 0 4px 15px rgba(107, 203, 119, 0.3);
                ">Start Shopping</button>
            `;
            
            successOverlay.appendChild(successContent);
            document.body.appendChild(successOverlay);
            
            // Add animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes slideUp {
                    from { transform: translateY(50px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            // Auto close after 4 seconds
            setTimeout(() => {
                closeJoinSuccess();
            }, 4000);
            
            window.closeJoinSuccess = function() {
                const overlay = document.querySelector('[style*="rgba(107, 203, 119, 0.95)"]');
                if (overlay) {
                    overlay.style.animation = 'fadeIn 0.3s ease reverse';
                    setTimeout(() => {
                        document.body.removeChild(overlay);
                        document.head.removeChild(style);
                        showPage('groupDashboard');
                        loadGroupDashboard();
                    }, 300);
                }
            }
        }

        function getVendorFormData() {
            const name = document.getElementById('vendorName').value;
            const phone = document.getElementById('vendorPhone').value;
            const area = document.getElementById('vendorArea').value;
            const whatsapp = document.getElementById('vendorWhatsapp').value;
            const email = document.getElementById('vendorEmail').value;
            const product = document.getElementById('vendorProduct').value;
            const timeSlot = document.getElementById('vendorTimeSlot').value;
            
            if (!name || !phone || !area || !email) {
                alert('Please fill all required fields');
                return null;
            }
            
            return {
                id: 'V' + Date.now(),
                name, phone, area, whatsapp, email, product, timeSlot,
                registeredAt: new Date().toISOString()
            };
        }

        window.verifyLicense = function() {
            const fileInput = document.getElementById('vendorLicense');
            if (fileInput.files.length === 0) {
                alert('Please select a license file first');
                return;
            }
            
            // Simulate verification
            setTimeout(() => {
                alert('License verified successfully! ✅');
                console.log('License verification completed');
            }, 1000);
        }

        // Supplier functions
        window.registerSupplier = function(event) {
            event.preventDefault();
            
            const supplierData = {
                id: 'S' + Date.now(),
                name: document.getElementById('supplierName').value,
                products: document.getElementById('supplierProducts').value,
                areas: document.getElementById('supplierAreas').value,
                contact: document.getElementById('supplierContact').value,
                minOrder: document.getElementById('supplierMinOrder').value,
                email: document.getElementById('supplierEmail').value,
                registeredAt: new Date().toISOString()
            };
            
            // Validate required fields
            if (!supplierData.name || !supplierData.contact || !supplierData.email) {
                alert('Please fill all required fields');
                return;
            }
            
            // Show OTP section and hide register button
            document.getElementById('supplierOtpSection').classList.remove('hidden');
            document.getElementById('registerSupplierBtn').classList.add('hidden');
            
            alert(`OTP sent to ${supplierData.email}!\nDemo OTP: 123456`);
            console.log('OTP sent for supplier registration');
        }
        
        window.verifySupplierOtp = function() {
            const enteredOtp = document.getElementById('supplierOtp').value;
            const correctOtp = '123456';
            
            if (enteredOtp === correctOtp) {
                const supplierData = {
                    id: 'S' + Date.now(),
                    name: document.getElementById('supplierName').value,
                    products: document.getElementById('supplierProducts').value,
                    areas: document.getElementById('supplierAreas').value,
                    contact: document.getElementById('supplierContact').value,
                    minOrder: document.getElementById('supplierMinOrder').value,
                    email: document.getElementById('supplierEmail').value,
                    registeredAt: new Date().toISOString()
                };
                
                suppliers.push(supplierData);
                localStorage.setItem('suppliers', JSON.stringify(suppliers));
                
                alert('OTP verified successfully! Supplier registered.');
                console.log('Supplier registered:', supplierData);
                
                showPage('supplierView');
                loadSupplierView();
            } else {
                alert('Invalid OTP! Please enter 123456');
            }
        }

        window.verifyFSSAI = function() {
            const fileInput = document.getElementById('fssaiLicense');
            if (fileInput.files.length === 0) {
                alert('Please select FSSAI license file first');
                return;
            }
            
            setTimeout(() => {
                alert('FSSAI License verified successfully! ✅');
                document.getElementById('verifyFSSAIBtn').textContent = 'Verified ✓';
                document.getElementById('verifyFSSAIBtn').style.background = 'var(--mint)';
                console.log('FSSAI license verification completed');
            }, 1000);
        }

        window.verifyTrading = function() {
            const fileInput = document.getElementById('tradingLicense');
            if (fileInput.files.length === 0) {
                alert('Please select trading license file first');
                return;
            }
            
            setTimeout(() => {
                alert('Trading License verified successfully! ✅');
                document.getElementById('verifyTradingBtn').textContent = 'Verified ✓';
                document.getElementById('verifyTradingBtn').style.background = 'var(--mint)';
                console.log('Trading license verification completed');
            }, 1000);
        }

        // Group Dashboard
        function loadGroupDashboard() {
            if (!currentGroup) return;
            
            document.getElementById('groupInfo').innerHTML = `
                <h3>Group: ${currentGroup.code}</h3>
                <p>Members: ${currentGroup.members.length}</p>
            `;
            
            const vendorsList = document.getElementById('vendorsList');
            vendorsList.innerHTML = currentGroup.members.map(vendor => `
                <div style="padding: 10px; margin: 5px 0; background: rgba(255,255,255,0.1); border-radius: 8px;">
                    <strong>${vendor.name}</strong><br>
                    <small>${vendor.area} | ${vendor.phone}</small>
                </div>
            `).join('');
            
            loadProductCatalog();
            loadCart();
            loadOrderSummary();
            loadPaymentHistory();
        }

        function loadProductCatalog(searchTerm = '', categoryFilter = '') {
            const catalogDiv = document.getElementById('productCatalog');
            
            // Filter products based on search term and category
            let filteredProducts = [];
            
            if (searchTerm) {
                filteredProducts = productCatalog.filter(product => 
                    product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    product.category.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }
            
            if (categoryFilter) {
                filteredProducts = productCatalog.filter(product => 
                    product.category === categoryFilter
                );
            }
            
            // Get unique categories for filter dropdown
            const categories = [...new Set(productCatalog.map(p => p.category))];
            
            catalogDiv.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                        <input type="text" id="productSearch" placeholder="🔍 Search products (e.g., rice, tomato, spices)... Press Enter to search" 
                               style="flex: 1; min-width: 200px; padding: 12px; border-radius: 10px; border: none; background: rgba(255,255,255,0.9); font-size: 1rem;"
                               onkeydown="handleProductSearch(event)" oninput="handleProductSearch(event)" value="${searchTerm}" autocomplete="off">
                        <select id="categoryFilter" onchange="handleCategoryFilter()" 
                                style="padding: 12px; border-radius: 10px; border: none; background: rgba(255,255,255,0.9);">
                            <option value="">All Categories</option>
                            ${categories.map(cat => `<option value="${cat}" ${cat === categoryFilter ? 'selected' : ''}>${cat}</option>`).join('')}
                        </select>
                        <button class="btn btn-small btn-secondary" onclick="clearFilters()">Clear</button>
                    </div>
                    ${searchTerm || categoryFilter ? `
                        <p style="margin-top: 10px; color: rgba(255,255,255,0.8);">
                            Found ${filteredProducts.length} products
                        </p>
                    ` : `
                        <p style="margin-top: 10px; color: rgba(255,255,255,0.8); text-align: center; font-style: italic;">
                            Start typing to search from ${productCatalog.length} available products
                        </p>
                    `}
                </div>
                
                ${(searchTerm || categoryFilter) && filteredProducts.length > 0 ? `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        ${filteredProducts.map(product => `
                            <div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px; text-align: center; transition: transform 0.3s ease;">
                                <div style="font-size: 2rem; margin-bottom: 10px;">${product.image}</div>
                                <h4>${product.name}</h4>
                                <p>₹${product.price}/${product.unit}</p>
                                <p><small style="background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 12px;">${product.category}</small></p>
                                <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin: 10px 0;">
                                    <input type="number" id="qty-${product.id}" min="1" value="1" style="width: 60px; padding: 5px; border-radius: 5px; border: none;">
                                    <span>${product.unit}</span>
                                </div>
                                <button class="btn btn-small btn-primary" onclick="addToCart(${product.id})">Add to Cart</button>
                            </div>
                        `).join('')}
                    </div>
                ` : (searchTerm || categoryFilter) ? `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.7);">
                        <h3>No products found</h3>
                        <p>Try searching for: rice, wheat, tomato, onion, spices, oil, etc.</p>
                    </div>
                ` : ''}
            `;
        }
        
        let searchDebounceTimer;
        window.handleProductSearch = function(event) {
            // Only trigger search on Enter key or when user stops typing for 1 second
            if (event && event.type === 'keydown' && event.key !== 'Enter') {
                return; // Don't search on every keystroke
            }
            
            // Clear previous timer to prevent multiple rapid calls
            clearTimeout(searchDebounceTimer);
            
            // If Enter key pressed, search immediately
            if (event && event.key === 'Enter') {
                const searchInput = document.getElementById('productSearch');
                const categorySelect = document.getElementById('categoryFilter');
                
                if (searchInput && categorySelect) {
                    const searchTerm = searchInput.value.trim();
                    const categoryFilter = categorySelect.value;
                    loadProductCatalog(searchTerm, categoryFilter);
                }
                return;
            }
            
            // Otherwise, wait for user to stop typing for 1 second
            searchDebounceTimer = setTimeout(() => {
                const searchInput = document.getElementById('productSearch');
                const categorySelect = document.getElementById('categoryFilter');
                
                if (searchInput && categorySelect) {
                    const searchTerm = searchInput.value.trim();
                    const categoryFilter = categorySelect.value;
                    loadProductCatalog(searchTerm, categoryFilter);
                }
            }, 1000); // Wait 1 second after user stops typing
        }
        
        window.handleCategoryFilter = function() {
            const searchTerm = document.getElementById('productSearch')?.value || '';
            const categoryFilter = document.getElementById('categoryFilter')?.value || '';
            loadProductCatalog(searchTerm, categoryFilter);
        }
        
        window.clearFilters = function() {
            const searchInput = document.getElementById('productSearch');
            const categorySelect = document.getElementById('categoryFilter');
            if (searchInput) searchInput.value = '';
            if (categorySelect) categorySelect.value = '';
            loadProductCatalog('', '');
        }

        window.addToCart = function(productId) {
            const product = productCatalog.find(p => p.id === productId);
            const quantity = parseInt(document.getElementById(`qty-${productId}`).value);
            
            if (!product || !quantity) return;
            
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += quantity;
                existingItem.total = existingItem.quantity * existingItem.price;
            } else {
                cart.push({
                    id: productId,
                    name: product.name,
                    price: product.price,
                    unit: product.unit,
                    quantity: quantity,
                    total: quantity * product.price,
                    image: product.image
                });
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
            alert(`${product.name} added to cart!`);
        }

        function loadCart() {
            const cartDiv = document.getElementById('cartItems');
            const cartTotalDiv = document.getElementById('cartTotal');
            
            if (cart.length === 0) {
                cartDiv.innerHTML = '<p>Your cart is empty</p>';
                cartTotalDiv.innerHTML = '';
                return;
            }
            
            const totalAmount = cart.reduce((sum, item) => sum + item.total, 0);
            const costPerVendor = currentGroup ? totalAmount / currentGroup.members.length : totalAmount;
            
            cartDiv.innerHTML = cart.map(item => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; margin: 5px 0; background: rgba(255,255,255,0.1); border-radius: 8px;">
                    <div>
                        <span>${item.image}</span>
                        <strong>${item.name}</strong><br>
                        <small>${item.quantity} ${item.unit} × ₹${item.price}</small>
                    </div>
                    <div>
                        <strong>₹${item.total}</strong>
                        <button onclick="removeFromCart(${item.id})" style="margin-left: 10px; background: #ff4757; color: white; border: none; border-radius: 5px; padding: 5px 8px; cursor: pointer;">×</button>
                    </div>
                </div>
            `).join('');
            
            cartTotalDiv.innerHTML = `
                <div style="margin-top: 15px; padding: 15px; background: rgba(107, 203, 119, 0.2); border-radius: 10px;">
                    <h4>Cart Summary:</h4>
                    <p><strong>Total Amount: ₹${totalAmount}</strong></p>
                    ${currentGroup ? `<p>Cost per vendor: ₹${costPerVendor.toFixed(2)}</p>
                    <p>Number of vendors: ${currentGroup.members.length}</p>` : ''}
                </div>
            `;
        }

        window.removeFromCart = function(productId) {
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
        }

        window.clearCart = function() {
            cart = [];
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
            alert('Cart cleared!');
        }

        window.checkout = function() {
            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            
            if (!currentGroup) {
                alert('Please join a group first!');
                return;
            }
            
            // Convert cart items to orders
            const orderItems = cart.map(item => ({
                id: 'O' + Date.now() + Math.random(),
                product: item.name,
                quantity: item.quantity,
                price: item.price,
                total: item.total,
                addedAt: new Date().toISOString()
            }));
            
            if (!currentGroup.orders) currentGroup.orders = [];
            currentGroup.orders.push(...orderItems);
            
            // Update groups in localStorage
            const groupIndex = groups.findIndex(g => g.id === currentGroup.id);
            if (groupIndex !== -1) {
                groups[groupIndex] = currentGroup;
                localStorage.setItem('groups', JSON.stringify(groups));
            }
            
            orders.push(...orderItems);
            localStorage.setItem('orders', JSON.stringify(orders));
            
            const totalAmount = cart.reduce((sum, item) => sum + item.total, 0);
            const costPerVendor = totalAmount / currentGroup.members.length;
            
            // Clear cart
            cart = [];
            localStorage.setItem('cart', JSON.stringify(cart));
            
            // Show payment simulation first, then success message
            showPaymentSimulation(orderItems, totalAmount, costPerVendor);
        }
        
        function showPaymentSimulation(orderItems, totalAmount, costPerVendor) {
            // Create payment simulation overlay
            const paymentOverlay = document.createElement('div');
            paymentOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(52, 73, 94, 0.95);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                animation: fadeIn 0.5s ease;
            `;
            
            const paymentContent = document.createElement('div');
            paymentContent.style.cssText = `
                background: white;
                padding: 40px;
                border-radius: 20px;
                text-align: center;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                max-width: 600px;
                width: 90%;
                animation: slideUp 0.6s ease;
            `;
            
            paymentContent.innerHTML = `
                <div style="font-size: 3rem; color: #3498db; margin-bottom: 20px;">💳</div>
                <h2 style="color: #2c3e50; margin-bottom: 20px;">Payment Simulation</h2>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: left;">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">Order Summary:</h3>
                    <div style="max-height: 200px; overflow-y: auto;">
                        ${orderItems.map(item => `
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #dee2e6;">
                                <span>${item.product} (${item.quantity})</span>
                                <strong>₹${item.total}</strong>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                        <span><strong>Total Amount:</strong></span>
                        <strong style="color: #1976d2;">₹${totalAmount}</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                        <span><strong>Group Members:</strong></span>
                        <strong>${currentGroup.members.length}</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 10px 0; padding-top: 10px; border-top: 2px solid #1976d2;">
                        <span><strong>Your Share:</strong></span>
                        <strong style="color: #d32f2f; font-size: 1.2rem;">₹${costPerVendor.toFixed(2)}</strong>
                    </div>
                </div>
                
                <div style="background: #fff3e0; padding: 15px; border-radius: 10px; margin: 20px 0;">
                    <h4 style="color: #f57c00; margin-bottom: 10px;">💰 Payment Options</h4>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="processPaymentMethod('UPI')" style="
                            background: #4caf50; color: white; border: none; padding: 10px 20px; 
                            border-radius: 25px; cursor: pointer; font-size: 0.9rem;
                        ">📱 UPI</button>
                        <button onclick="processPaymentMethod('Card')" style="
                            background: #2196f3; color: white; border: none; padding: 10px 20px; 
                            border-radius: 25px; cursor: pointer; font-size: 0.9rem;
                        ">💳 Card</button>
                        <button onclick="processPaymentMethod('Cash')" style="
                            background: #ff9800; color: white; border: none; padding: 10px 20px; 
                            border-radius: 25px; cursor: pointer; font-size: 0.9rem;
                        ">💵 Cash</button>
                        <button onclick="processPaymentMethod('Wallet')" style="
                            background: #9c27b0; color: white; border: none; padding: 10px 20px; 
                            border-radius: 25px; cursor: pointer; font-size: 0.9rem;
                        ">👛 Wallet</button>
                    </div>
                </div>
                
                <p style="color: #6c757d; margin: 15px 0; font-size: 0.9rem;">
                    Choose your preferred payment method to complete the order
                </p>
            `;
            
            paymentOverlay.appendChild(paymentContent);
            document.body.appendChild(paymentOverlay);
            
            // Store order data for payment processing
            window.currentOrderData = { orderItems, totalAmount, costPerVendor };
            
            // Add animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes slideUp {
                    from { transform: translateY(50px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            // Payment method processing function
            window.processPaymentMethod = function(method) {
                const { orderItems, totalAmount, costPerVendor } = window.currentOrderData;
                
                // Remove payment overlay
                const overlay = document.querySelector('[style*="rgba(52, 73, 94, 0.95)"]');
                if (overlay) {
                    overlay.style.animation = 'fadeIn 0.3s ease reverse';
                    setTimeout(() => {
                        document.body.removeChild(overlay);
                        document.head.removeChild(style);
                        
                        // Show payment processing animation
                        showPaymentProcessing(method, () => {
                            // After payment processing, show success message
                            showOrderSuccessMessage(orderItems.length, totalAmount, costPerVendor);
                            loadCart();
                            loadOrderSummary();
                        });
                    }, 300);
                }
            }
        }
        
        function showPaymentProcessing(method, callback) {
            const processingOverlay = document.createElement('div');
            processingOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(76, 175, 80, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                animation: fadeIn 0.5s ease;
            `;
            
            const processingContent = document.createElement('div');
            processingContent.style.cssText = `
                background: white;
                padding: 40px;
                border-radius: 20px;
                text-align: center;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                max-width: 400px;
                animation: slideUp 0.6s ease;
            `;
            
            const methodIcons = {
                'UPI': '📱',
                'Card': '💳',
                'Cash': '💵',
                'Wallet': '👛'
            };
            
            processingContent.innerHTML = `
                <div style="font-size: 4rem; margin-bottom: 20px; animation: spin 2s linear infinite;">
                    ${methodIcons[method]}
                </div>
                <h3 style="color: #2c3e50; margin-bottom: 15px;">Processing ${method} Payment...</h3>
                <div style="width: 100%; height: 4px; background: #e0e0e0; border-radius: 2px; overflow: hidden; margin: 20px 0;">
                    <div style="width: 0%; height: 100%; background: linear-gradient(45deg, #4caf50, #8bc34a); border-radius: 2px; animation: progressBar 3s ease-in-out forwards;"></div>
                </div>
                <p style="color: #666; font-size: 0.9rem;">Please wait while we process your payment...</p>
            `;
            
            processingOverlay.appendChild(processingContent);
            document.body.appendChild(processingOverlay);
            
            // Add processing animations
            const processingStyle = document.createElement('style');
            processingStyle.textContent = `
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
                @keyframes progressBar {
                    from { width: 0%; }
                    to { width: 100%; }
                }
            `;
            document.head.appendChild(processingStyle);
            
            // Simulate payment processing time
            setTimeout(() => {
                processingOverlay.style.animation = 'fadeIn 0.5s ease reverse';
                setTimeout(() => {
                    document.body.removeChild(processingOverlay);
                    document.head.removeChild(processingStyle);
                    callback(); // Call the success callback
                }, 500);
            }, 3000); // 3 seconds processing time
        }
        
        function showOrderSuccessMessage(itemCount, totalAmount, costPerVendor) {
            // Create success overlay
            const successOverlay = document.createElement('div');
            successOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(107, 203, 119, 0.95);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                animation: fadeIn 0.5s ease;
            `;
            
            const successContent = document.createElement('div');
            successContent.style.cssText = `
                background: white;
                padding: 40px;
                border-radius: 20px;
                text-align: center;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                max-width: 500px;
                animation: slideUp 0.6s ease;
            `;
            
            successContent.innerHTML = `
                <div style="font-size: 4rem; color: #6BCB77; margin-bottom: 20px;">✅</div>
                <h2 style="color: #2c3e50; margin-bottom: 15px;">Order Placed Successfully!</h2>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <p style="margin: 8px 0; color: #495057;"><strong>Items Ordered:</strong> ${itemCount}</p>
                    <p style="margin: 8px 0; color: #495057;"><strong>Total Amount:</strong> ₹${totalAmount}</p>
                    <p style="margin: 8px 0; color: #495057;"><strong>Your Share:</strong> ₹${costPerVendor.toFixed(2)}</p>
                    <p style="margin: 8px 0; color: #495057;"><strong>Group Members:</strong> ${currentGroup.members.length}</p>
                </div>
                <p style="color: #6c757d; margin: 15px 0;">Your bulk order has been sent to suppliers. You'll receive delivery updates soon!</p>
                <button onclick="closeSuccessMessage()" style="
                    background: linear-gradient(45deg, #6BCB77, #4ecdc4);
                    color: white;
                    border: none;
                    padding: 12px 30px;
                    border-radius: 25px;
                    font-size: 1rem;
                    cursor: pointer;
                    margin-top: 20px;
                    box-shadow: 0 4px 15px rgba(107, 203, 119, 0.3);
                ">Continue Shopping</button>
            `;
            
            successOverlay.appendChild(successContent);
            document.body.appendChild(successOverlay);
            
            // Add animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes slideUp {
                    from { transform: translateY(50px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            // Auto close after 5 seconds
            setTimeout(() => {
                closeSuccessMessage();
            }, 5000);
            
            window.closeSuccessMessage = function() {
                const overlay = document.querySelector('[style*="rgba(107, 203, 119, 0.95)"]');
                if (overlay) {
                    overlay.style.animation = 'fadeIn 0.3s ease reverse';
                    setTimeout(() => {
                        document.body.removeChild(overlay);
                        document.head.removeChild(style);
                    }, 300);
                }
            }
        }

        function loadOrderSummary() {
            if (!currentGroup || !currentGroup.orders) return;
            
            const orderSummary = document.getElementById('orderSummary');
            const costCalculation = document.getElementById('costCalculation');
            
            if (currentGroup.orders.length === 0) {
                orderSummary.innerHTML = '<p>No items in order yet.</p>';
                costCalculation.innerHTML = '';
                return;
            }
            
            const totalCost = currentGroup.orders.reduce((sum, item) => sum + item.total, 0);
            const costPerVendor = totalCost / currentGroup.members.length;
            
            orderSummary.innerHTML = `
                <h4>Current Order:</h4>
                ${currentGroup.orders.map(item => `
                    <div style="padding: 8px; margin: 4px 0; background: rgba(0,0,0,0.1); border-radius: 5px;">
                        ${item.product}: ${item.quantity} units × ₹${item.price} = ₹${item.total}
                    </div>
                `).join('')}
            `;
            
            costCalculation.innerHTML = `
                <div style="margin-top: 15px; padding: 15px; background: rgba(107, 203, 119, 0.2); border-radius: 10px;">
                    <h4>Cost Breakdown:</h4>
                    <p><strong>Total Cost: ₹${totalCost}</strong></p>
                    <p>Cost per vendor: ₹${costPerVendor.toFixed(2)}</p>
                    <p>Number of vendors: ${currentGroup.members.length}</p>
                </div>
            `;
        }

        window.markAsPaid = function() {
            const isPaid = document.getElementById('paidToggle').checked;
            
            if (isPaid && currentGroup && currentGroup.orders.length > 0) {
                const totalCost = currentGroup.orders.reduce((sum, item) => sum + item.total, 0);
                const costPerVendor = totalCost / currentGroup.members.length;
                
                const payment = {
                    id: 'P' + Date.now(),
                    groupId: currentGroup.id,
                    amount: costPerVendor,
                    totalAmount: totalCost,
                    paidAt: new Date().toISOString(),
                    orders: [...currentGroup.orders]
                };
                
                paymentHistory.push(payment);
                localStorage.setItem('paymentHistory', JSON.stringify(paymentHistory));
                
                alert(`Payment marked as paid! Amount: ₹${costPerVendor.toFixed(2)}`);
                loadPaymentHistory();
            }
        }

        function loadPaymentHistory() {
            const historyDiv = document.getElementById('paymentHistory');
            const groupPayments = paymentHistory.filter(p => p.groupId === currentGroup?.id);
            
            if (groupPayments.length === 0) {
                historyDiv.innerHTML = '<p>No payment history yet.</p>';
                return;
            }
            
            historyDiv.innerHTML = groupPayments.map(payment => `
                <div style="padding: 10px; margin: 5px 0; background: rgba(255,255,255,0.1); border-radius: 8px;">
                    <strong>₹${payment.amount.toFixed(2)}</strong> - ${new Date(payment.paidAt).toLocaleDateString()}
                    <br><small>Total Order: ₹${payment.totalAmount}</small>
                </div>
            `).join('');
        }

        // Supplier View
        function loadSupplierView() {
            const incomingOrders = document.getElementById('incomingOrders');
            const paymentDetails = document.getElementById('paymentDetails');
            
            // Show recent orders with more details
            const recentOrders = orders.slice(-10);
            // Get accepted orders from localStorage
            const acceptedOrders = JSON.parse(localStorage.getItem('acceptedOrders') || '[]');
            
            incomingOrders.innerHTML = recentOrders.length > 0 ? 
                recentOrders.map(order => {
                    const isAccepted = acceptedOrders.includes(order.id);
                    return `
                        <div style="padding: 12px; margin: 8px 0; background: rgba(255,255,255,0.1); border-radius: 8px; border-left: 4px solid var(--coral);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>${order.product}</strong><br>
                                    <small>Qty: ${order.quantity} | Unit Price: ₹${order.price}</small><br>
                                    <small style="color: #7f8c8d;">${new Date(order.addedAt).toLocaleDateString()}</small>
                                </div>
                                <div style="text-align: right;">
                                    <strong style="color: var(--mint);">₹${order.total}</strong><br>
                                    ${isAccepted ? 
                                        '<span style="color: var(--mint); font-size: 1.5rem;">✓</span><br><small style="color: var(--mint);">Accepted</small>' :
                                        `<button class="btn btn-small btn-secondary" onclick="acceptOrder('${order.id}')" style="margin-top: 5px;">Accept</button>`
                                    }
                                </div>
                            </div>
                        </div>
                    `;
                }).join('') : '<p>No incoming orders</p>';
            
            // Show enhanced payment simulation
            const totalRevenue = orders.reduce((sum, order) => sum + order.total, 0);
            const supplierPayments = JSON.parse(localStorage.getItem('supplierPayments') || '[]');
            const completedPayments = supplierPayments.reduce((sum, payment) => sum + parseFloat(payment.amount), 0);
            const pendingAmount = (totalRevenue * 0.3) - completedPayments;
            
            paymentDetails.innerHTML = `
                <div style="background: rgba(107, 203, 119, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h4>Revenue Summary</h4>
                    <p><strong>Total Revenue: ₹${totalRevenue.toFixed(2)}</strong></p>
                    <p>Completed Payments: ₹${completedPayments.toFixed(2)}</p>
                    <p>Pending Payments: ₹${Math.max(0, pendingAmount).toFixed(2)}</p>
                    <p>Commission (30%): ₹${(totalRevenue * 0.3).toFixed(2)}</p>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.1); padding: 10px; border-radius: 8px;">
                    <h5>Recent Payments:</h5>
                    ${supplierPayments.length > 0 ? 
                        supplierPayments.slice(-3).map(payment => `
                            <div style="padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <strong>₹${payment.amount}</strong> - ${payment.id}<br>
                                <small>${new Date(payment.processedAt).toLocaleDateString()}</small>
                            </div>
                        `).join('') : '<p>No payments yet</p>'
                    }
                </div>
            `;
            
            // Clear UPI field for user input
            document.getElementById('upiId').value = '';
        }

        window.acceptOrder = function(orderId) {
            // Add order to accepted orders list
            let acceptedOrders = JSON.parse(localStorage.getItem('acceptedOrders') || '[]');
            if (!acceptedOrders.includes(orderId)) {
                acceptedOrders.push(orderId);
                localStorage.setItem('acceptedOrders', JSON.stringify(acceptedOrders));
            }
            
            alert(`Order ${orderId} accepted! Delivery will be scheduled.`);
            console.log('Order accepted:', orderId);
            
            // Refresh the supplier view to show the tick mark
            loadSupplierView();
        }

        window.confirmDelivery = function() {
            const deliveryTime = document.getElementById('deliveryTime').value;
            
            // Create huge tick overlay
            const tickOverlay = document.createElement('div');
            tickOverlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(107, 203, 119, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                animation: fadeIn 0.5s ease;
            `;
            
            const hugeTick = document.createElement('div');
            hugeTick.style.cssText = `
                font-size: 15rem;
                color: white;
                text-shadow: 0 0 50px rgba(255,255,255,0.5);
                animation: tickBounce 1s ease;
            `;
            hugeTick.textContent = '✓';
            
            const confirmText = document.createElement('div');
            confirmText.style.cssText = `
                position: absolute;
                bottom: 30%;
                font-size: 2rem;
                color: white;
                text-align: center;
                font-weight: bold;
            `;
            confirmText.textContent = `Delivery Confirmed for ${deliveryTime}!`;
            
            tickOverlay.appendChild(hugeTick);
            tickOverlay.appendChild(confirmText);
            document.body.appendChild(tickOverlay);
            
            // Add animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes tickBounce {
                    0% { transform: scale(0) rotate(0deg); }
                    50% { transform: scale(1.2) rotate(180deg); }
                    100% { transform: scale(1) rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
            
            // Remove overlay after 3 seconds
            setTimeout(() => {
                tickOverlay.style.animation = 'fadeIn 0.5s ease reverse';
                setTimeout(() => {
                    document.body.removeChild(tickOverlay);
                    document.head.removeChild(style);
                }, 500);
            }, 3000);
            
            console.log('Delivery confirmed:', deliveryTime);
        }

        window.processPayment = function() {
            const upiId = document.getElementById('upiId').value;
            const totalRevenue = orders.reduce((sum, order) => sum + order.total, 0);
            const paymentAmount = (totalRevenue * 0.3).toFixed(2);
            
            // Simulate payment processing
            const paymentId = 'PAY' + Date.now();
            const payment = {
                id: paymentId,
                amount: paymentAmount,
                upiId: upiId,
                status: 'completed',
                processedAt: new Date().toISOString()
            };
            
            // Store payment record
            let supplierPayments = JSON.parse(localStorage.getItem('supplierPayments') || '[]');
            supplierPayments.push(payment);
            localStorage.setItem('supplierPayments', JSON.stringify(supplierPayments));
            
            alert(`Payment of ₹${paymentAmount} processed successfully!\nPayment ID: ${paymentId}\nUPI: ${upiId}`);
            
            // Update payment details display
            loadSupplierView();
            console.log('Payment processed:', payment);
        }

        // Cart view function
        window.showCartView = function() {
            const cartViewContent = document.getElementById('cartViewContent');
            
            if (cart.length === 0) {
                cartViewContent.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <h3>Your cart is empty</h3>
                        <p>Add some products from the catalog to get started!</p>
                    </div>
                `;
            } else {
                const totalAmount = cart.reduce((sum, item) => sum + item.total, 0);
                const costPerVendor = currentGroup ? totalAmount / currentGroup.members.length : totalAmount;
                
                cartViewContent.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <h3>Cart Items (${cart.length})</h3>
                    </div>
                    
                    <div style="display: grid; gap: 15px;">
                        ${cart.map(item => `
                            <div style="background: rgba(255,255,255,0.1); border-radius: 10px; padding: 20px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <span style="font-size: 2rem;">${item.image}</span>
                                        <div>
                                            <h4>${item.name}</h4>
                                            <p style="color: #7f8c8d; margin: 5px 0;">₹${item.price} per ${item.unit}</p>
                                            <p><strong>Quantity: ${item.quantity} ${item.unit}</strong></p>
                                        </div>
                                    </div>
                                    <div style="text-align: right;">
                                        <h3 style="color: var(--mint);">₹${item.total}</h3>
                                        <button onclick="removeFromCart(${item.id}); showCartView();" 
                                                style="background: #ff4757; color: white; border: none; border-radius: 5px; padding: 8px 12px; cursor: pointer; margin-top: 10px;">
                                            Remove
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="margin-top: 30px; padding: 20px; background: rgba(107, 203, 119, 0.2); border-radius: 15px;">
                        <h3>Order Summary</h3>
                        <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                            <span>Total Items:</span>
                            <strong>${cart.length}</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                            <span>Total Amount:</span>
                            <strong>₹${totalAmount}</strong>
                        </div>
                        ${currentGroup ? `
                            <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                                <span>Group Members:</span>
                                <strong>${currentGroup.members.length}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.3);">
                                <span>Cost per Vendor:</span>
                                <strong style="color: var(--coral);">₹${costPerVendor.toFixed(2)}</strong>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            showPage('cartViewPage');
        }

        // Invoice functions
        window.generateInvoice = function() {
            // Use current group orders or all orders if no group
            let ordersToInvoice = [];
            
            if (currentGroup && currentGroup.orders && currentGroup.orders.length > 0) {
                ordersToInvoice = currentGroup.orders;
            } else if (cart.length > 0) {
                // If no orders but cart has items, use cart items
                ordersToInvoice = cart.map(item => ({
                    product: item.name,
                    quantity: item.quantity,
                    price: item.price,
                    total: item.total
                }));
            } else {
                // Use all orders as fallback
                ordersToInvoice = orders;
            }
            
            if (ordersToInvoice.length === 0) {
                alert('No items to generate invoice for. Please add items to cart or place an order first.');
                return;
            }
            
            const invoiceId = 'INV-' + Date.now();
            const invoiceDate = new Date().toLocaleDateString();
            
            document.getElementById('invoiceId').textContent = `Invoice #: ${invoiceId}`;
            document.getElementById('invoiceDate').textContent = `Date: ${invoiceDate}`;
            
            const invoiceItems = document.getElementById('invoiceItems');
            let grandTotal = 0;
            
            // Generate invoice items
            invoiceItems.innerHTML = ordersToInvoice.map(item => {
                grandTotal += item.total;
                return `
                    <tr>
                        <td>${item.product}</td>
                        <td>${item.quantity}</td>
                        <td>₹${item.price}</td>
                        <td>₹${item.total}</td>
                    </tr>
                `;
            }).join('');
            
            document.getElementById('grandTotal').textContent = `Grand Total: ₹${grandTotal}`;
            
            // Add group information if available
            if (currentGroup) {
                const costPerVendor = grandTotal / currentGroup.members.length;
                document.getElementById('grandTotal').innerHTML = `
                    Grand Total: ₹${grandTotal}<br>
                    <small style="color: var(--text-secondary);">Cost per vendor (${currentGroup.members.length} members): ₹${costPerVendor.toFixed(2)}</small>
                `;
            }
            
            showPage('invoicePage');
            console.log('Invoice generated with', ordersToInvoice.length, 'items');
        }

        window.downloadInvoice = function() {
            const invoiceContent = document.getElementById('invoicePage').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Invoice</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .invoice-header { display: flex; justify-content: space-between; border-bottom: 2px solid #FF6B6B; padding-bottom: 20px; margin-bottom: 30px; }
                        .invoice-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        .invoice-table th, .invoice-table td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
                        .invoice-table th { background: #FF6B6B; color: white; }
                        .logo { font-size: 2rem; font-weight: bold; color: #FF6B6B; }
                        .btn { display: none; }
                    </style>
                </head>
                <body>${invoiceContent}</body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
            printWindow.close();
        }

        window.printInvoice = function() {
            // Show demo bill instead of actual printing
            showDemoBill();
        }
        
        function showDemoBill() {
            const demoBillWindow = window.open('', '_blank', 'width=800,height=600');
            const demoItems = [
                { name: 'Basmati Rice', qty: '10 kg', price: '₹80', total: '₹800' },
                { name: 'Cooking Oil', qty: '5 liter', price: '₹120', total: '₹600' },
                { name: 'Onions', qty: '20 kg', price: '₹30', total: '₹600' },
                { name: 'Tomatoes', qty: '15 kg', price: '₹40', total: '₹600' },
                { name: 'Turmeric Powder', qty: '2 kg', price: '₹150', total: '₹300' },
                { name: 'Red Chili Powder', qty: '1 kg', price: '₹200', total: '₹200' }
            ];
            
            const grandTotal = 3100;
            const groupMembers = 5;
            const costPerVendor = grandTotal / groupMembers;
            
            demoBillWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>VendorConnect - Invoice</title>
                    <style>
                        body { 
                            font-family: Arial, sans-serif; 
                            margin: 20px; 
                            background: #f5f5f5;
                        }
                        .invoice-container {
                            background: white;
                            padding: 30px;
                            border-radius: 10px;
                            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
                            max-width: 800px;
                            margin: 0 auto;
                        }
                        .invoice-header { 
                            display: flex; 
                            justify-content: space-between; 
                            align-items: center;
                            border-bottom: 3px solid #FF6B6B; 
                            padding-bottom: 20px; 
                            margin-bottom: 30px; 
                        }
                        .logo { 
                            font-size: 2.5rem; 
                            font-weight: bold; 
                            color: #FF6B6B; 
                            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
                        }
                        .invoice-info {
                            text-align: right;
                            color: #666;
                        }
                        .invoice-table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            margin: 20px 0; 
                            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                            border-radius: 8px;
                            overflow: hidden;
                        }
                        .invoice-table th { 
                            background: linear-gradient(45deg, #FF6B6B, #FFD93D); 
                            color: white; 
                            padding: 15px 12px;
                            font-weight: bold;
                            text-align: left;
                        }
                        .invoice-table td { 
                            padding: 12px; 
                            border-bottom: 1px solid #eee; 
                        }
                        .invoice-table tr:hover {
                            background: #f9f9f9;
                        }
                        .total-section {
                            background: linear-gradient(45deg, #6BCB77, #4ecdc4);
                            color: white;
                            padding: 20px;
                            border-radius: 10px;
                            margin-top: 20px;
                            text-align: right;
                        }
                        .group-info {
                            background: #f8f9fa;
                            padding: 15px;
                            border-radius: 8px;
                            margin: 20px 0;
                            border-left: 4px solid #FF6B6B;
                        }
                        .print-btn {
                            background: linear-gradient(45deg, #FF6B6B, #FFD93D);
                            color: white;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 25px;
                            cursor: pointer;
                            font-size: 1rem;
                            margin: 20px 10px;
                            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
                            transition: all 0.3s ease;
                        }
                        .print-btn:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
                        }
                        @media print {
                            .print-btn { display: none; }
                            body { background: white; }
                            .invoice-container { box-shadow: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="invoice-container">
                        <div class="invoice-header">
                            <div class="logo">VendorConnect</div>
                            <div class="invoice-info">
                                <h2>INVOICE</h2>
                                <p><strong>Invoice #:</strong> INV-${Date.now()}</p>
                                <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
                                <p><strong>Time:</strong> ${new Date().toLocaleTimeString()}</p>
                            </div>
                        </div>
                        
                        <div class="group-info">
                            <h3>📦 Bulk Order Summary</h3>
                            <p><strong>Group Code:</strong> ${currentGroup ? currentGroup.code : 'DEMO123'}</p>
                            <p><strong>Total Members:</strong> ${groupMembers}</p>
                            <p><strong>Order Type:</strong> Bulk Purchase</p>
                        </div>
                        
                        <table class="invoice-table">
                            <thead>
                                <tr>
                                    <th>🛒 Item</th>
                                    <th>📊 Quantity</th>
                                    <th>💰 Unit Price</th>
                                    <th>💵 Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${demoItems.map(item => `
                                    <tr>
                                        <td><strong>${item.name}</strong></td>
                                        <td>${item.qty}</td>
                                        <td>${item.price}</td>
                                        <td><strong>${item.total}</strong></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        
                        <div class="total-section">
                            <h3>💰 Payment Summary</h3>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                                <span>Subtotal:</span>
                                <strong>₹${grandTotal}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                                <span>Bulk Discount (5%):</span>
                                <strong>-₹${(grandTotal * 0.05).toFixed(0)}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 10px 0; font-size: 1.2rem; border-top: 1px solid rgba(255,255,255,0.3); padding-top: 10px;">
                                <span>Grand Total:</span>
                                <strong>₹${(grandTotal * 0.95).toFixed(0)}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 15px 0; font-size: 1.1rem; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 5px;">
                                <span>Cost per Vendor (${groupMembers} members):</span>
                                <strong>₹${(costPerVendor * 0.95).toFixed(0)}</strong>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px; color: #666;">
                            <p>📞 Contact: support@vendorconnect.com | 📱 +91-9876543210</p>
                            <p>🌐 www.vendorconnect.com | Empowering Street Vendors</p>
                            <p style="margin-top: 15px; font-style: italic;">Thank you for choosing VendorConnect! 🙏</p>
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="print-btn" onclick="window.print()">🖨️ Print Invoice</button>
                            <button class="print-btn" onclick="window.close()">❌ Close</button>
                        </div>
                    </div>
                </body>
                </html>
            `);
            
            demoBillWindow.document.close();
        }

        // Admin functions
        window.toggleAdmin = function() {
            const isAdmin = document.getElementById('adminToggle').checked;
            if (isAdmin) {
                showPage('adminPanel');
                loadAdminData();
            } else {
                showPage('landingPage');
            }
        }

        function loadAdminData() {
            // Load vendor list
            const adminVendorList = document.getElementById('adminVendorList');
            if (adminVendorList) {
                adminVendorList.innerHTML = vendors.length > 0 ? 
                    vendors.map(vendor => `
                        <div style="padding: 8px; margin: 4px 0; background: rgba(255,255,255,0.1); border-radius: 5px;">
                            ${vendor.name} - ${vendor.area}
                        </div>
                    `).join('') : '<p>No vendors registered</p>';
            }
            
            // Load supplier list
            const adminSupplierList = document.getElementById('adminSupplierList');
            if (adminSupplierList) {
                adminSupplierList.innerHTML = suppliers.length > 0 ? 
                    suppliers.map(supplier => `
                        <div style="padding: 8px; margin: 4px 0; background: rgba(255,255,255,0.1); border-radius: 5px;">
                            ${supplier.name} - ${supplier.products}
                        </div>
                    `).join('') : '<p>No suppliers registered</p>';
            }
            
            // Load group list
            const adminGroupList = document.getElementById('adminGroupList');
            if (adminGroupList) {
                adminGroupList.innerHTML = groups.length > 0 ? 
                    groups.map(group => `
                        <div style="padding: 8px; margin: 4px 0; background: rgba(255,255,255,0.1); border-radius: 5px;">
                            <input type="radio" name="selectedGroup" value="${group.id}">
                            ${group.code} - ${group.members.length} members
                        </div>
                    `).join('') : '<p>No groups created</p>';
            }
            
            // Load order summary
            const adminOrderSummary = document.getElementById('adminOrderSummary');
            if (adminOrderSummary) {
                const totalOrders = orders.length;
                const totalRevenue = orders.reduce((sum, order) => sum + order.total, 0);
                
                adminOrderSummary.innerHTML = `
                    <p>Total Orders: ${totalOrders}</p>
                    <p>Total Revenue: ₹${totalRevenue}</p>
                    <p>Active Groups: ${groups.length}</p>
                    <p>Registered Vendors: ${vendors.length}</p>
                    <p>Registered Suppliers: ${suppliers.length}</p>
                `;
            }
        }

        window.deleteGroup = function() {
            const selectedGroup = document.querySelector('input[name="selectedGroup"]:checked');
            if (!selectedGroup) {
                alert('Please select a group to delete');
                return;
            }
            
            const groupId = selectedGroup.value;
            groups = groups.filter(g => g.id !== groupId);
            localStorage.setItem('groups', JSON.stringify(groups));
            
            alert('Group deleted successfully!');
            loadAdminData();
        }

        window.resetSimulation = function() {
            if (confirm('Are you sure you want to reset all simulation data?')) {
                localStorage.clear();
                vendors = [];
                suppliers = [];
                groups = [];
                orders = [];
                paymentHistory = [];
                currentUser = null;
                currentGroup = null;
                
                alert('Simulation reset successfully!');
                showPage('landingPage');
                loadAdminData();
            }
        }

        // Chatbot functions
        window.toggleChatbot = function() {
            const chatbotWindow = document.getElementById('chatbotWindow');
            chatbotWindow.classList.toggle('hidden');
        }

        window.handleChatInput = function(event) {
            if (event.key === 'Enter') {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                if (message) {
                    addChatMessage('user', message);
                    input.value = '';
                    
                    // Simple chatbot responses
                    setTimeout(() => {
                        const response = getChatbotResponse(message);
                        addChatMessage('bot', response);
                    }, 500);
                }
            }
        }

        function addChatMessage(sender, message) {
            const messagesDiv = document.getElementById('chatbotMessages');
            const messageDiv = document.createElement('div');
            messageDiv.style.margin = '10px 0';
            messageDiv.style.padding = '8px 12px';
            messageDiv.style.borderRadius = '10px';
            
            if (sender === 'user') {
                messageDiv.style.background = 'rgba(255, 107, 107, 0.3)';
                messageDiv.style.textAlign = 'right';
            } else {
                messageDiv.style.background = 'rgba(107, 203, 119, 0.3)';
            }
            
            messageDiv.textContent = message;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function getChatbotResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            const responses = {
                en: {
                    'hello': 'Hello! Welcome to VendorConnect! 👋 I can help you with registration, groups, orders, and payments. 😊',
                    'hi': 'Hello! Welcome to VendorConnect! 👋 I can help you with registration, groups, orders, and payments. 😊',
                    'help': 'I can assist you with: 🤝\n• 📝 Vendor/Supplier registration\n• 👥 Creating or joining groups\n• 🛒 Adding products to cart\n• 💳 Payment processing\n• 📄 Invoice generation\nWhat would you like to know? 🤔',
                    'register': 'To register as a vendor, click "Join a Vendor Group" and fill out the form 📝. For suppliers, click "Become a Supplier" 🏪. You\'ll need to upload your license for verification ✅.',
                    'group': 'Groups allow vendors to buy in bulk together! 🤝 You can:\n• 🆕 Create a new group (you\'ll get a unique code)\n• 🔗 Join existing group with a code\n• 💰 Share costs with other members',
                    'code': 'Group codes are unique 6-character identifiers (like GRP123ABC) 🔑. The group creator gets this code and shares it with other vendors to join! 📤',
                    'order': 'To place orders: 📦\n1. 👥 Join a vendor group\n2. 🔍 Browse the product catalog\n3. 🛒 Add items to your cart\n4. ✅ Click checkout to place bulk order\n5. 💰 Costs are split among group members!',
                    'cart': 'Your cart shows selected products 🛒. You can adjust quantities, remove items, and see the total cost 💰. When you checkout, items become group orders! 📦',
                    'payment': 'Payments are split among group members 💰. Mark orders as paid using the toggle switch ✅. Suppliers can process payments through the UPI system 📱.',
                    'supplier': 'Suppliers can: 🏪\n• 👀 View incoming orders from vendor groups\n• ✅ Accept/manage orders\n• 💳 Process payments via UPI\n• 📄 Generate invoices\n• 📊 Track revenue and commissions',
                    'invoice': 'Invoices are automatically generated for completed orders 📄. You can download as PDF 📥 or print them directly from the system 🖨️.',
                    'admin': 'Admin panel (toggle in header) shows: ⚙️\n• 👥 All registered vendors and suppliers\n• 🏢 Active groups and their members\n• 📊 Order summaries and revenue\n• 🛠️ System management tools',
                    'language': 'VendorConnect supports English, Hindi (हिंदी), and Tamil (தமிழ்) 🌍. Change language using the dropdown in the header! 🔄',
                    'price': 'Bulk buying reduces costs! 💰 When multiple vendors order together, you get better prices and split shipping costs 📦. The system automatically calculates cost per vendor! 🧮',
                    'default': 'I\'m here to help! 🤖 You can ask me about:\n• 📝 Registration process\n• 👥 Creating/joining groups\n• 📦 Placing orders\n• 💳 Payment system\n• 🏪 Supplier features\n• ⚙️ Admin functions\n\nWhat specific topic interests you? 🤔'
                },
                hi: {
                    'hello': 'नमस्ते! वेंडरकनेक्ट में आपका स्वागत है! 👋 मैं पंजीकरण, समूह, ऑर्डर और भुगतान में आपकी मदद कर सकता हूं। 😊',
                    'help': 'मैं इनमें आपकी सहायता कर सकता हूं: 🤝\n• 📝 विक्रेता/आपूर्तिकर्ता पंजीकरण\n• 👥 समूह बनाना या जुड़ना\n• 🛒 कार्ट में उत्पाद जोड़ना\n• 💳 भुगतान प्रक्रिया\n• 📄 चालान निर्माण\nआप क्या जानना चाहते हैं? 🤔',
                    'register': 'विक्रेता के रूप में पंजीकरण के लिए, "विक्रेता समूह में शामिल हों" पर क्लिक करें 📝। आपूर्तिकर्ताओं के लिए "आपूर्तिकर्ता बनें" पर क्लिक करें 🏪।',
                    'group': 'समूह विक्रेताओं को एक साथ थोक खरीदारी करने की अनुमति देते हैं! 🤝 आप कर सकते हैं:\n• 🆕 नया समूह बनाएं\n• 🔗 कोड के साथ मौजूदा समूह में शामिल हों\n• 💰 अन्य सदस्यों के साथ लागत साझा करें',
                    'order': 'ऑर्डर देने के लिए: 📦\n1. 👥 विक्रेता समूह में शामिल हों\n2. 🔍 उत्पाद कैटलॉग ब्राउज़ करें\n3. 🛒 कार्ट में आइटम जोड़ें\n4. ✅ थोक ऑर्डर देने के लिए चेकआउट पर क्लिक करें',
                    'payment': 'भुगतान समूह के सदस्यों के बीच बांटा जाता है 💰। टॉगल स्विच का उपयोग करके ऑर्डर को भुगतान के रूप में चिह्नित करें ✅।',
                    'default': 'मैं यहां मदद के लिए हूं! 🤖 आप मुझसे पूछ सकते हैं:\n• 📝 पंजीकरण प्रक्रिया\n• 👥 समूह बनाना/जुड़ना\n• 📦 ऑर्डर देना\n• 💳 भुगतान सिस्टम\nकौन सा विषय आपको दिलचस्प लगता है? 🤔'
                },
                ta: {
                    'hello': 'வணக்கம்! வெண்டர்கனெக்ட்டில் உங்களை வரவேற்கிறோம்! 👋 பதிவு, குழுக்கள், ஆர்டர்கள் மற்றும் பணம் செலுத்துதலில் நான் உங்களுக்கு உதவ முடியும். 😊',
                    'help': 'நான் இவற்றில் உங்களுக்கு உதவ முடியும்: 🤝\n• 📝 விற்பனையாளர்/சப்ளையர் பதிவு\n• 👥 குழுக்களை உருவாக்குதல் அல்லது சேருதல்\n• 🛒 கார்ட்டில் தயாரிப்புகளைச் சேர்த்தல்\n• 💳 பணம் செலுத்தும் செயல்முறை\nநீங்கள் என்ன தெரிந்து கொள்ள விரும்புகிறீர்கள்? 🤔',
                    'register': 'விற்பனையாளராக பதிவு செய்ய, "விற்பனையாளர் குழுவில் சேரவும்" என்பதைக் கிளிக் செய்யவும் 📝। சப்ளையர்களுக்கு "சப்ளையர் ஆகவும்" என்பதைக் கிளிக் செய்யவும் 🏪।',
                    'group': 'குழுக்கள் விற்பனையாளர்களை ஒன்றாக மொத்த வாங்குதலை அனுமதிக்கின்றன! 🤝 நீங்கள் செய்யலாம்:\n• 🆕 புதிய குழுவை உருவாக்கவும்\n• 🔗 குறியீட்டுடன் ஏற்கனவே உள்ள குழுவில் சேரவும்',
                    'order': 'ஆர்டர் செய்ய: 📦\n1. 👥 விற்பனையாளர் குழுவில் சேரவும்\n2. 🔍 தயாரிப்பு பட்டியலைப் பார்க்கவும்\n3. 🛒 கார்ட்டில் பொருட்களைச் சேர்க்கவும்\n4. ✅ மொத்த ஆர்டர் செய்ய செக்அவுட் கிளிக் செய்யவும்',
                    'payment': 'பணம் செலுத்துதல் குழு உறுப்பினர்களிடையே பிரிக்கப்படுகிறது 💰। டாகிள் சுவிட்சைப் பயன்படுத்தி ஆர்டர்களை பணம் செலுத்தியதாக குறிக்கவும் ✅।',
                    'default': 'நான் உதவுவதற்காக இங்கே இருக்கிறேன்! 🤖 நீங்கள் என்னிடம் கேட்கலாம்:\n• 📝 பதிவு செயல்முறை\n• 👥 குழு உருவாக்குதல்/சேருதல்\n• 📦 ஆர்டர் செய்தல்\n• 💳 பணம் செலுத்தும் அமைப்பு\nஎந்த தலைப்பு உங்களுக்கு ஆர்வமாக உள்ளது? 🤔'
                }
            };
            
            const langResponses = responses[currentLanguage] || responses.en;
            
            // Enhanced keyword matching with context awareness
            const keywords = [
                'hello', 'hi', 'help', 'register', 'registration', 'group', 'code', 'order', 'cart', 
                'payment', 'pay', 'supplier', 'invoice', 'admin', 'language', 'price', 'cost', 
                'bulk', 'join', 'create', 'checkout', 'vendor', 'product', 'catalog'
            ];
            
            for (const keyword of keywords) {
                if (lowerMessage.includes(keyword) && langResponses[keyword]) {
                    return langResponses[keyword];
                }
            }
            
            // Context-aware responses based on current page
            const currentPage = document.querySelector('.page:not(.hidden)');
            if (currentPage) {
                const pageId = currentPage.id;
                if (pageId === 'groupDashboard' && lowerMessage.includes('how')) {
                    return langResponses.order || langResponses.default;
                } else if (pageId === 'supplierView' && lowerMessage.includes('payment')) {
                    return langResponses.supplier || langResponses.default;
                }
            }
            
            return langResponses.default;
        }

        // Event listeners
        document.getElementById('languageSelect').addEventListener('change', changeLanguage);
        document.getElementById('adminToggle').addEventListener('change', toggleAdmin);
        document.getElementById('vendorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            // Form submission handled by create/join group buttons
        });
        document.getElementById('supplierForm').addEventListener('submit', registerSupplier);
        document.getElementById('loginForm').addEventListener('submit', login);

        // Initialize
        updateLanguage();
        
        // Auto-save functionality
        setInterval(() => {
            if (currentGroup) {
                localStorage.setItem('currentGroup', JSON.stringify(currentGroup));
            }
        }, 30000); // Auto-save every 30 seconds
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9657691e33cca92c',t:'MTc1MzU2OTc1Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
